flows:
  add_contact:
    description: add a contact to your contact list
    name: add a contact
    nlu_trigger:
      - intent:
          name: add_contact
          confidence_threshold: 0.9
    steps:
      - collect: add_contact_handle
        description: a user handle starting with @
      - collect: add_contact_name
        description: a name of a person
      - action: utter_add_contact_cancelled
      - call: schedule_doctor
        description: schedule a doctor appointment
      - collect: add_contact_confirmation
        ask_before_filling: true
        next:
          - if: not slots.add_contact_confirmation
            then:
              - action: utter_add_contact_cancelled
                next: END
          - else: add_contact
      - id: add_contact
        action: add_contact
        next:
          - if: "slots.return_value = 'success'"
            then:
              - action: utter_contact_added
                next: END
          - if: "slots.return_value = 'already_exists'"
            then:
              - action: utter_contact_already_exists
                next: END
          - else:
              - action: utter_add_contact_error
                next: END

  schedule_doctor:
    description: schedule a doctor appointment
    name: schedule doctor appointment
    persisted_slots:
      - schedule_doctor_date
      - schedule_doctor_time
    steps:
      - collect: schedule_doctor_date
        description: date for the appointment
      - collect: schedule_doctor_time
        description: time for the appointment
      - collect: schedule_doctor_confirmation
        ask_before_filling: true
        next:
          - if: not slots.schedule_doctor_confirmation
            then:
              - action: utter_schedule_doctor_cancelled
                next: END
          - else: schedule_doctor
      - id: schedule_doctor
        action: schedule_doctor_appointment
        next:
          - if: "slots.return_value = 'success'"
            then:
              - action: utter_appointment_scheduled
                next: END
          - else:
              - action: utter_schedule_doctor_error
                next: END